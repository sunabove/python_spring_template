<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" >

<head th:replace="~{layout.html :: head}">

	<title th:text="${html.title}"> html.title </title>
	<base th:href="@{/}">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

	<link rel="stylesheet" th:href="@{/rsc/css/python.css}" href="rsc/css/python.css" />
	<link rel="stylesheet" th:href="@{/rsc/css/sidebars.css}" href="./rsc/css/sidebars.css" />

	<!-- Font Awesome icons (free version)-->
	<script src="https://use.fontawesome.com/releases/v6.5.2/js/all.js" crossorigin="anonymous"></script>
	<script src="https://kit.fontawesome.com/fb6a9a8bef.js" crossorigin="anonymous"></script>

	<!-- Google fonts-->
	<link rel="preconnect" href="https://fonts.gstatic.com" />
	<link href="https://fonts.googleapis.com/css2?family=Tinos:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet" />
	<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&amp;display=swap" rel="stylesheet" />

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.1.2/dist/chart.umd.min.js"></script>

</head> 

<body class="container-fluid" >

	<!--  start of header --> 

	<div th:replace="~{layout.html :: header}" >
	</div>
	
	<!-- end of header -->

	<!-- main content -->

	<div class="wrapper d-flex align-items-stretch border-top border-bottom" >

		<!--  side bar left -->
		<nav th:replace="~{layout.html :: sidebarLeft}" id="sidebarLeft" class="container-fluid col-auto d-md-block bg-body-tertiary sidebar collapse">
		</nav>
		<!-- // side bar left --> 

		<!-- main content --> 

		<main class="me-2 container-fluid" style="overflow-y: auto; "> 

			<div class="card text-center mt-3">

				<div class="card-header d-flex justify-content-center">
					<span class="h5"> 파이썬 유투브 </span>
				</div>

				<script>
					const apiKey = 'AIzaSyBAjSZD4sldb4ESh5RF-jijb_vZEYxcRg0'; // API 키 보안에 주의하세요!
					const channelId = 'UChtLQnkBZ8KZ-8b3K9xNS9w'; // Python Korea 채널 ID
				</script>

				<div class="card-body d-flex justify-content-center">
					<div id="playlists" class="playlists-container">
						<p>재생목록을 불러오는 중...</p>
					</div>

					<!-- 📌 템플릿 요소 추가 -->
					<div id="playlist-template" class="playlist-card" style="display: none;">
						<img src="" alt="" class="playlist-thumbnail">
						<h3 class="playlist-title"></h3>
						<p class="playlist-description"></p>
						<a href="#" target="_blank" class="playlist-link">재생목록 보기</a>
					</div>

					<script> 
						async function fetchPlaylists() {
							try {
								const response = await fetch(
									`https://www.googleapis.com/youtube/v3/playlists?part=snippet&channelId=${channelId}&maxResults=10&key=${apiKey}`
								);
								const data = await response.json();

								const container = document.getElementById("playlists");
								const template = document.getElementById("playlist-template");

								container.innerHTML = ""; // 기존 내용 초기화

								if (!data.items || data.items.length === 0) {
									container.innerHTML = "<p>재생목록이 없습니다.</p>";
									return;
								}

								// 📌 'A'로 시작하는 제목 제외 및 첫 단어가 알파벳 한 글자인 경우 삭제
								let playlists = data.items
									.filter(playlist => !playlist.snippet.title.startsWith('A')) // 'A'로 시작하는 제목 제외
									.map(playlist => {
										let title = playlist.snippet.title;
										let words = title.split(' ');

										// 📌 첫 번째 단어가 알파벳 한 글자인 경우 제거
										if (words[0].length === 1 && /^[A-Z]$/.test(words[0])) {
											words.shift();
										}

										let modifiedTitle = words.join(' '); // 수정된 제목

										return { ...playlist, modifiedTitle }; // 수정된 제목을 객체에 추가
									});

								// 📌 제목을 알파벳 순으로 정렬
								playlists.sort((a, b) => a.modifiedTitle.localeCompare(b.modifiedTitle));

								// 📌 재생목록 UI 생성
								playlists.forEach(playlist => {
									const title = playlist.modifiedTitle;
									const description = playlist.snippet.description;
									const thumbnail = playlist.snippet.thumbnails?.medium?.url || "";
									const playlistId = playlist.id;

									// 📌 템플릿 클론 생성
									const clone = template.cloneNode(true);
									clone.style.display = "block";

									// 📌 클론 내부 요소 업데이트
									clone.querySelector(".playlist-thumbnail").src = thumbnail;
									clone.querySelector(".playlist-thumbnail").alt = title;
									clone.querySelector(".playlist-title").textContent = title;
									clone.querySelector(".playlist-description").textContent = description;
									clone.querySelector(".playlist-link").href = `https://www.youtube.com/playlist?list=${playlistId}`;

									// 📌 복제된 요소 추가
									container.appendChild(clone);
								});
							} catch (error) {
								console.error("API 요청 중 오류 발생:", error);
								document.getElementById("playlists").innerHTML = "<p>재생목록을 불러오는 데 실패했습니다.</p>";
							}
						}

						fetchPlaylists();

					</script>

					<style>
						/* 📌 재생목록 컨테이너 스타일 */
						.playlists-container {
							display: flex;
							flex-wrap: wrap;  /* 📌 여러 줄로 배치 가능 */
							justify-content: center; /* 📌 가운데 정렬 */
							gap: 15px; /* 📌 카드 간격 */
							padding: 20px;
							align-items: stretch; /* 📌 카드 높이 동일하게 조정 */
						}

						/* 📌 재생목록 카드 스타일 */
						.playlist-card {
							width: 240px; /* 카드 너비 */
							background: #f9f9f9;
							border-radius: 10px;
							padding: 15px;
							text-align: center;
							box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
							transition: transform 0.3s ease-in-out;
							display: flex;
							flex-direction: column;
							height: auto; /* 📌 내용에 맞게 조정 */
							min-height: 320px; /* 📌 최소 높이 설정 */
						}

						/* 📌 카드 호버 효과 */
						.playlist-card:hover {
							transform: scale(1.05);
						}

						/* 📌 썸네일 이미지 스타일 */
						.playlist-thumbnail {
							width: 100%;
							max-width: 100%;
							border-radius: 8px;
						}

						/* 📌 재생목록 제목 */
						.playlist-title {
							font-size: 16px;
							margin: 10px 0;
							font-weight: bold;
						}

						/* 📌 재생목록 설명 */
						.playlist-description {
							font-size: 14px;
							color: #666;
							word-wrap: break-word;
							white-space: normal;
							max-height: 60px; /* 📌 최대 높이 제한 */
							overflow: hidden; /* 📌 넘치면 숨김 */
							text-overflow: ellipsis; /* 📌 말줄임표 추가 */
						}

						/* 📌 재생목록 보기 버튼 */
						.playlist-link {
							display: inline-block;
							margin-top: auto; /* 📌 버튼을 항상 아래에 위치 */
							padding: 8px 12px;
							background: #007bff; /* 📌 파란색 계열 */
							color: white;
							text-decoration: none;
							border-radius: 5px;
							font-size: 14px;
							font-weight: bold;
							transition: background 0.3s ease-in-out;
						}

						.playlist-link:hover {
							background: #0056b3;
						}

						
					</style>
				</div>

				<div class="card-footer d-flex justify-content-center">
					푸터
				</div>

			</div>
			 
		</main>

		<!-- // main content --> 

		<!--  side bar right -->
		<nav th:replace="~{layout.html :: sidebarRight}" id="sidebarRight" class="col-auto d-md-block bg-body-tertiary_ sidebar collapse">
		</nav>
		<!-- // side bar right-->
		
	</div>

	<!-- // main content -->

	<!-- footer -->

	<footer th:replace="~{layout.html :: footer}" class="text-center text-lg-start bg-light text-muted">
	</footer>

	<!-- // footer -->

</body>

</html>
